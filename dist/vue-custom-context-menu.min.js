import{resolveDirective as e,withDirectives as t,openBlock as n,createBlock as s,renderSlot as o,withScopeId as i,pushScopeId as l,popScopeId as a,resolveComponent as r,createVNode as c,withModifiers as d,createCommentVNode as h}from"vue";function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var p=new Map;function m(e,t,n){var s='[v-context-menu="'.concat(t.expression.replace(/\"/,"'"),'"]');if(null===t.value){if(n.componentInstance&&"context-menu-item"===n.componentInstance.$options._componentTag)p.set(n.elm,{listener:null,cm:null}),n.componentInstance.calls=null;else{var o=function(e){e.stopPropagation(),e.altKey||e.preventDefault()};p.set(e,{listener:o,cm:null}),e.addEventListener("contextmenu",o)}return null}if("string"==typeof t.value){var i=n.context.$refs[t.value];if(i){if(i instanceof HTMLElement)throw new Error("".concat(s," | The 'v-context-menu' directive must point to either the 'ContextMenu' component or a 'ContextMenu' wrapper-component, but it points to a '").concat(i.tagName,"' HTML element"));if("context-menu"!==i.$options._componentTag&&(!(i=i.$refs["wrapped-context-menu"])||i instanceof HTMLElement||"context-menu"!==i.$options._componentTag))throw new Error("".concat(s," | Couldn't find the 'ContextMenu' component with the reference 'wrapped-context-menu' inside the '").concat(t.value,"' wrapper-component"));if(n.componentInstance&&"context-menu-item"===n.componentInstance.$options._componentTag)p.set(n.elm,{listener:null,cm:i}),n.componentInstance.calls=i;else{var l=function(e){e.stopPropagation(),e.altKey||(e.preventDefault(),i.immediateOpen(e))};p.set(e,{listener:l,cm:i}),e.addEventListener("contextmenu",l)}return i}throw new Error("".concat(s," | Couldn't find a context menu by the reference '").concat(t.value,"'"))}throw new TypeError("".concat(s," | The 'v-context-menu' directive only accepts 'null' and 'string' values, but '").concat(u(t.value),"' is provided"))}function f(e){var t=p.get(e),n=t.listener,s=t.cm;return n&&e.removeEventListener("contextmenu",n),p.delete(e),s}var y={bind:function(e,t,n){m(e,t,n)},update:function(e,t,n){if(t.oldValue!==t.value){var s=f(e),o=m(e,t,n);s&&s.show&&s.event.target===e&&(s.immediateClose(),o&&o.immediateOpen(s.event,s.caller,s.parent))}},unbind:function(e){var t=f(e);t&&t.show&&t.event.target===e&&t.immediateClose()}},v={props:{isRoot:{type:Boolean,required:!0},zIndex:{type:Number,required:!0},penetrable:{type:Boolean,required:!0}},methods:{close(e){3===e.which&&e.altKey||(this.penetrable?this.$emit("close"):(e.stopPropagation(),setTimeout((()=>{this.$emit("close")}),0)))}}};const b=i("data-v-fca6041c")(((i,l,a,r,c,d)=>{const h=e("context-menu");return t((n(),s("div",{class:["context-menu-overlay",{root:a.isRoot,nested:!a.isRoot}],style:{zIndex:a.zIndex},onMousedown:l[1]||(l[1]=e=>d.close(e))},[o(i.$slots,"default")],38)),[[h,null]])}));function x(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var s=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&s.firstChild?s.insertBefore(o,s.firstChild):s.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}x("\n.context-menu-overlay[data-v-fca6041c] {\n    position: fixed;\n    top: 0;\n    left: 0;\n    display: block;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n}\n.nested[data-v-fca6041c] {\n    pointer-events: none;\n}\n"),v.render=b,v.__scopeId="data-v-fca6041c",v.__file="src/components/ContextMenuOverlay.vue";var g={components:{ContextMenuOverlay:v},props:{penetrable:{type:Boolean,default:!1},shift:{type:String,default:"x",validator:e=>["fit","x","y","both"].includes(e)},delay:{type:Number,default:500,validator:e=>e>0}},computed:{root:{cache:!1,get(){return this.isRoot?this:(()=>{let e=this;for(;e;){var t=e;e=e.parent}return t})()}},overlayElement:{cache:!1,get(){return this.$refs.overlay.$el}},wrapperElement:{cache:!1,get(){return this.$refs.wrapper}}},data:()=>({show:!1,event:void 0,caller:void 0,isRoot:!0,zIndex:1e5,style:{left:0,top:0,height:"auto"},parent:null,sub:null,openTimer:null,closeTimer:null}),methods:{abstractOpen(e,t,n){n&&!n.show||this.show||(this.event=e,this.caller=t,n&&(this.parent=n,this.parent.sub=this,this.isRoot=!1,this.zIndex=n.zIndex+1),this.show=!0,this.transpose(),this.isRoot&&(document.documentElement.style.overflow="hidden",document.addEventListener("keydown",this.closeOnEscKey)),this.openTimer=null,this.$emit("opened",this))},immediateOpen(e,t,n){this.cancelDelayedOpen(),this.abstractOpen(e,t,n)},delayedOpen(e,t,n){this.cancelDelayedOpen(),this.openTimer=setTimeout((()=>{this.abstractOpen(e,t,n)}),n.delay)},cancelDelayedOpen(){this.openTimer&&(clearTimeout(this.openTimer),this.openTimer=null)},abstractClose(){this.show&&(this.parent&&(this.parent.sub=null),this.sub&&(this.sub.immediateClose(),this.sub=null),this.isRoot&&(document.documentElement.style.overflow="",document.removeEventListener("keydown",this.closeOnEscKey)),this.show=!1,this.style.height="auto",this.zIndex=1e5,this.closeTimer=null,this.$emit("closed",this))},immediateClose(){this.cancelDelayedClose(),this.abstractClose()},delayedClose(){this.cancelDelayedClose(),this.closeTimer=setTimeout((()=>{this.abstractClose()}),this.parent.delay)},cancelDelayedClose(){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null)},closeOnEscKey(e){if(27===e.keyCode){let e=this;for(;e.sub;)e=e.sub;e.immediateClose()}},preventCollapsing(){let e=this;for(;e;)e.cancelDelayedClose(),e=e.parent},transpose(){this.caller?(this.style.left=`${this.caller.getBoundingClientRect().right}px`,this.style.top=`${this.caller.getBoundingClientRect().top}px`):(this.style.left=`${this.event.clientX}px`,this.style.top=`${this.event.clientY}px`),this.style.height="auto",this.$nextTick((()=>{let e=this.overlayElement.getBoundingClientRect().width,t=this.overlayElement.getBoundingClientRect().height,n=this.wrapperElement.getBoundingClientRect().width,s=this.wrapperElement.getBoundingClientRect().height,o=this.wrapperElement.getBoundingClientRect().right,i=this.wrapperElement.getBoundingClientRect().bottom;o>e&&("x"===this.shift||"both"===this.shift?this.caller?this.style.left=this.caller.getBoundingClientRect().left-n+"px":this.style.left=parseFloat(this.style.left)-n+"px":this.style.left=e-n+"px"),i>t&&("y"===this.shift||"both"===this.shift?this.caller?this.style.top=this.caller.getBoundingClientRect().bottom-s+"px":this.style.top=parseFloat(this.style.top)-s+"px":this.style.top=t-s+"px"),parseFloat(this.style.top)<0&&(this.style.top="0px",s>t&&(this.style.height=`${t}px`))}))}}};const C=i("data-v-2cd1f2a4");l("data-v-2cd1f2a4");const w={class:"context-menu"};a();const T=C(((e,t,i,l,a,u)=>{const p=r("context-menu-overlay");return a.show?(n(),s(p,{key:0,ref:"overlay","is-root":a.isRoot,"z-index":a.zIndex,penetrable:i.penetrable,onClose:u.immediateClose},{default:C((()=>[c("div",{ref:"wrapper",class:["context-menu-wrapper",{root:a.isRoot,nested:!a.isRoot}],style:a.style,onMouseenter:t[1]||(t[1]=(...e)=>u.preventCollapsing&&u.preventCollapsing(...e)),onMousedown:t[2]||(t[2]=d((()=>{}),["stop"]))},[c("div",w,[o(e.$slots,"default")])],38)])),_:3},8,["is-root","z-index","penetrable","onClose"])):h("v-if",!0)}));x("\n.context-menu-wrapper[data-v-2cd1f2a4] {\n    position: absolute;\n    pointer-events: initial;\n}\n.context-menu[data-v-2cd1f2a4] {\n    box-sizing: border-box;\n    height: 100%;\n    overflow: auto;\n}\n"),g.render=T,g.__scopeId="data-v-2cd1f2a4",g.__file="src/components/ContextMenu.vue";var E={props:{action:{type:Function,default:function(){}},disabled:{type:Boolean,default:!1}},data:()=>({calls:void 0}),computed:{cm(){return this.$parent.$parent},isCaller(){return!!this.calls},isDisabled(){return null===this.calls||this.disabled}},watch:{isDisabled(e){!0===e&&this.isCaller&&(this.calls.cancelDelayedOpen(),setTimeout((()=>{this.calls.immediateClose()}),0))},calls(e,t){this.isCaller&&t&&t.cancelDelayedOpen()}},methods:{itemSelected(e){this.isDisabled||(this.isCaller?this.cm.sub===this.calls?this.calls.cancelDelayedClose():(this.cm.sub&&this.cm.sub.delayedClose(),this.calls.delayedOpen(e,this.$el,this.cm)):this.cm.sub&&(this.cm.sub.closeTimer||this.cm.sub.delayedClose()))},selectionAborted(e){this.isDisabled||this.isCaller&&this.calls.cancelDelayedOpen()},itemTriggered(e){if(!this.isDisabled)if(this.isCaller)this.cm.sub!==this.calls&&(this.cm.sub&&this.cm.sub.immediateClose(),this.calls.immediateOpen(e,this.$el,this.cm));else{if(3===e.which&&e.altKey)return;this.action(this.cm.event.target,this.cm),setTimeout((()=>{this.cm.root.immediateClose()}),0)}}}};E.render=function(e,t,i,l,a,r){return n(),s("div",{class:["context-menu-item",{caller:r.isCaller,disabled:r.isDisabled}],onMouseenter:t[1]||(t[1]=(...e)=>r.itemSelected&&r.itemSelected(...e)),onMouseleave:t[2]||(t[2]=(...e)=>r.selectionAborted&&r.selectionAborted(...e)),onMousedown:t[3]||(t[3]=(...e)=>r.itemTriggered&&r.itemTriggered(...e))},[o(e.$slots,"default")],34)},E.__file="src/components/ContextMenuItem.vue";var $,R={install:function(e){e.directive("context-menu",y),e.component("ContextMenu",g),e.component("ContextMenuItem",E)}};"undefined"!=typeof window?$=window.Vue:"undefined"!=typeof global&&($=global.Vue),$&&$.use(R);export default R;
