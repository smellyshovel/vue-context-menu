/* Matthew Mamonov aka smellyshovel <g.smellyshovel@gmail.com> (https://github.com/smellyshovel/vue-custom-context-menu) Â© 2018 */(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.VCCM=b()})("undefined"==typeof self?this:self,function(){"use strict";function a(a){return{bind:function(b,c,g){g.componentInstance&&g.componentOptions.tag===a.item?g.context.$nextTick(function(){f(a,b,c,g),g.componentInstance.calls=e}):(f(a,b,c,g),b.addEventListener("contextmenu",function(a){a.stopPropagation(),!c.modifiers["no-native"]&&!1!==a.altKey||(a.preventDefault(),!c.modifiers.disabled&&(e.targetComp=g.componentInstance||g.elm,d.open(),e.immediateOpen(a)))}))},update:function(b,c,d){c.oldValue!==c.value&&f(a,b,c,d)}}}function b(){const a=document.head||document.getElementsByTagName("head")[0],c=b.styles||(b.styles={}),d="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(b,e){if(document.querySelector("style[data-vue-ssr-id~=\""+b+"\"]"))return;const f=d?e.media||"default":b,g=c[f]||(c[f]={ids:[],parts:[],element:void 0});if(!g.ids.includes(b)){let c=e.source,h=g.ids.length;if(g.ids.push(b),d&&(g.element=g.element||document.querySelector("style[data-group="+f+"]")),!g.element){const b=g.element=document.createElement("style");b.type="text/css",e.media&&b.setAttribute("media",e.media),d&&(b.setAttribute("data-group",f),b.setAttribute("data-next-index","0")),a.appendChild(b)}if(d&&(h=parseInt(g.element.getAttribute("data-next-index")),g.element.setAttribute("data-next-index",h+1)),g.element.styleSheet)g.parts.push(c),g.element.styleSheet.cssText=g.parts.filter(Boolean).join("\n");else{const a=document.createTextNode(c),b=g.element.childNodes;b[h]&&g.element.removeChild(b[h]),b.length?g.element.insertBefore(a,b[h]):g.element.appendChild(a)}}}}function c(){const a=document.head||document.getElementsByTagName("head")[0],b=c.styles||(c.styles={}),d="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(c,e){if(document.querySelector("style[data-vue-ssr-id~=\""+c+"\"]"))return;const f=d?e.media||"default":c,g=b[f]||(b[f]={ids:[],parts:[],element:void 0});if(!g.ids.includes(c)){let b=e.source,h=g.ids.length;if(g.ids.push(c),d&&(g.element=g.element||document.querySelector("style[data-group="+f+"]")),!g.element){const b=g.element=document.createElement("style");b.type="text/css",e.media&&b.setAttribute("media",e.media),d&&(b.setAttribute("data-group",f),b.setAttribute("data-next-index","0")),a.appendChild(b)}if(d&&(h=parseInt(g.element.getAttribute("data-next-index")),g.element.setAttribute("data-next-index",h+1)),g.element.styleSheet)g.parts.push(b),g.element.styleSheet.cssText=g.parts.filter(Boolean).join("\n");else{const a=document.createTextNode(b),c=g.element.childNodes;c[h]&&g.element.removeChild(c[h]),c.length?g.element.insertBefore(a,c[h]):g.element.appendChild(a)}}}}var d,e,f=function(a,b,c,f){d=a.ref in f.context.$root.$children[0].$refs?f.context.$root.$children[0].$refs[a.ref].$children.find(function(b){return b.$options._componentTag===a.overlay}):f.context.$children.find(function(b){return b.$options._componentTag===a.overlay}),e=d.$children.find(function(a){return a.$el===document.querySelector(c.value)})},g={props:{transition:String,penetrable:Boolean},mounted:function(){var a=this;this.penetrable?this.$el.addEventListener("mousedown",function(){a.$el.style.display="none",a.close()}):this.$el.addEventListener("mousedown",function(){a.close()})},data:function(){var a=this;return{show:!1,listeners:{closeOnEscKey:function(b){if(27===b.keyCode){var c=a.$children.find(function(a){return null===a.sub&&a.show}),d=c.parent;c.immediateClose(),d||a.close(!0)}}}}},methods:{open:function(){this.show=!0,document.documentElement.style.overflow="hidden",document.addEventListener("keydown",this.listeners.closeOnEscKey)},close:function(a){this.show=!1,a||this.$children.forEach(function(a){a.immediateClose()}),document.documentElement.style.overflow="",document.removeEventListener("keydown",this.listeners.closeOnEscKey)}}};var h=function(){var a=this,b=a.$createElement,c=a._self._c||b;return c("transition",{attrs:{name:a.transition}},[c("div",{directives:[{name:"show",rawName:"v-show",value:a.show,expression:"show"}],attrs:{id:"vccm-overlay"},on:{contextmenu:function(a){a.preventDefault(),a.stopPropagation()}}},[a._t("default")],2)])};h._withStripped=!0;var i=function(a,b,c,d,e,f,g){const h=("function"==typeof c?c.options:c)||{};h.__file="/home/matt/projects/vue-custom-context-menu/src/components/Overlay.vue",h.render||(h.render=a.render,h.staticRenderFns=a.staticRenderFns,h._compiled=!0,e&&(h.functional=!0)),h._scopeId=d;{let a;if(b&&(a=function(a){b.call(this,g(a))}),null!=a)if(h.functional){const b=h.render;h.render=function(c,d){return a.call(d),b(c,d)}}else{const b=h.beforeCreate;h.beforeCreate=b?[].concat(b,a):[a]}}return h}({render:h,staticRenderFns:[]},function(a){a&&a("data-v-ce4ca2e8_0",{source:"\n#vccm-overlay[data-v-ce4ca2e8] {\n    position: fixed;\n    top: 0;\n    left: 0;\n    display: block;\n    width: 100vw;\n    height: 100vh;\n    overflow: hidden;\n    z-index: 10000;\n}\n",map:{version:3,sources:["/home/matt/projects/vue-custom-context-menu/src/components/Overlay.vue"],names:[],mappings:";AAqFA;IACA,gBAAA;IACA,OAAA;IACA,QAAA;IACA,eAAA;IACA,aAAA;IACA,cAAA;IACA,iBAAA;IACA,eAAA;CACA",file:"Overlay.vue",sourcesContent:["<template>\n    <transition\n        :name=\"transition\"\n\n        ><div\n            id=\"vccm-overlay\"\n            v-show=\"show\"\n\n            @contextmenu.prevent.stop\n\n            ><slot></slot>\n        </div>\n    </transition>\n</template>\n\n<script>\n    export default {\n        props: {\n            transition: String,\n            penetrable: Boolean\n        },\n\n        mounted() {\n            if (this.penetrable) {\n                this.$el.addEventListener(\"mousedown\", (event) => {\n                    // without this hack \"contextmenu\" event would trigger on the\n                    // overlay instead of the element beneath it\n                    this.$el.style.display = \"none\";\n\n                    this.close();\n                });\n            } else {\n                this.$el.addEventListener(\"mousedown\", (event) => {\n                    this.close();\n                });\n            }\n        },\n\n        data() {return {\n            show: false,\n\n            listeners: {\n                closeOnEscKey: (event) => {\n                    if (event.keyCode === 27) {\n                        let nestedMost = this.$children.find((child) => {\n                            return child.sub === null && child.show;\n                        });\n\n                        let hadParent = nestedMost.parent;\n\n                        nestedMost.immediateClose();\n\n                        if (!hadParent) {\n                            this.close(true);\n                        }\n                    }\n                }\n            }\n        }},\n\n        methods: {\n            open() {\n                this.show = true;\n\n                document.documentElement.style.overflow = \"hidden\";\n                document.addEventListener(\"keydown\", this.listeners.closeOnEscKey);\n            },\n\n            close(skipChildren) {\n                this.show = false;\n\n                if (!skipChildren) {\n                    this.$children.forEach((child) => {\n                        child.immediateClose();\n                    });\n                }\n\n                document.documentElement.style.overflow = \"\";\n                document.removeEventListener(\"keydown\", this.listeners.closeOnEscKey);\n            }\n        }\n    }\n</script>\n\n<style scoped>\n    #vccm-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        display: block;\n        width: 100vw;\n        height: 100vh;\n        overflow: hidden;\n        z-index: 10000;\n    }\n</style>\n"]},media:void 0})},g,"data-v-ce4ca2e8",!1,void 0,b,void 0),j={props:{transition:String,shift:{type:String,default:"x",validator:function(a){return["fit","x","y","both"].includes(a)}},delay:{type:Number,default:250,validator:function(a){return 0<a}}},data:function(){return{show:!1,style:{left:0,top:0,height:"auto",zIndex:1},targetComp:null,parent:null,sub:null,openTimer:null,closeTimer:null}},computed:{overlay:function(){return this.$parent},target:function(){for(var a=this;a.parent;)a=a.parent;return a.targetComp}},methods:{open:function(a,b){var c=this;this.show=!0,this.style.zIndex=b?this.parent.style.zIndex+1:this.style.zIndex,this.setPosition(a,b),this.$nextTick(function(){c.transpose(b)})},abstractOpen:function(a,b,c){this.show||(c&&(this.parent=c,this.parent.sub=this),this.open(a,b),this.openTimer=null,this.$emit("opened",this.target,this))},immediateOpen:function(a,b,c){this.cancelDelayedOpen(),this.abstractOpen(a,b,c)},delayedOpen:function(a,b,c){var d=this;this.cancelDelayedOpen(),this.openTimer=setTimeout(function(){d.abstractOpen(a,b,c)},c.delay)},cancelDelayedOpen:function(){this.openTimer&&(clearTimeout(this.openTimer),this.openTimer=null)},close:function(){this.show=!1,this.targetComp=null,this.style.height="auto",this.style.zIndex=1},abstractClose:function(){if(this.show){var a=this.target;this.parent&&(this.parent.sub=null,this.parent=null),this.sub&&(this.sub.immediateClose(),this.sub=null),this.close(),this.closeTimer=null,this.$emit("closed",a,this)}},immediateClose:function(){this.cancelDelayedClose(),this.abstractClose()},delayedClose:function(){var a=this;this.cancelDelayedClose(),this.closeTimer=setTimeout(function(){a.abstractClose()},this.parent.delay)},cancelDelayedClose:function(){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null)},preventCollapsing:function(){for(var a=this;a;)a.cancelDelayedClose(),a=a.parent},setPosition:function(a,b){b?(this.style.left=b.getBoundingClientRect().right,this.style.top=b.getBoundingClientRect().top):(this.style.left=a.clientX,this.style.top=a.clientY),this.style.left+="px",this.style.top+="px"},transpose:function(a){var b=this,c=this.overlay.$el.getBoundingClientRect().width,d=this.overlay.$el.getBoundingClientRect().height,e=this.$el.getBoundingClientRect().width,f=this.$el.getBoundingClientRect().height,g=this.$el.getBoundingClientRect().right,h=this.$el.getBoundingClientRect().bottom;g>=c&&("x"===this.shift||"both"===this.shift?a?this.style.left=a.getBoundingClientRect().left-e:this.style.left=parseFloat(this.style.left)-e:this.style.left=c-e),h>=d&&("y"===this.shift||"both"===this.shift?a?this.style.top=a.getBoundingClientRect().bottom-f:this.style.top=parseFloat(this.style.top)-f:this.style.top=d-f),this.style.left+="px",this.style.top+="px",this.$nextTick(function(){0>parseFloat(b.style.top)&&(b.style.top="0px",f>d&&(b.style.height=d+"px"))})}}};var k=function(){var a=this,b=a.$createElement,c=a._self._c||b;return c("transition",{attrs:{name:a.transition}},[c("div",{directives:[{name:"show",rawName:"v-show",value:a.show,expression:"show"}],staticClass:"cm",style:a.style,on:{mouseenter:a.preventCollapsing,mousedown:function(a){a.stopPropagation()}}},[c("div",[c("ol",[a._t("default")],2)])])])};k._withStripped=!0;var l=function(a,b,c,d,e,f,g){const h=("function"==typeof c?c.options:c)||{};h.__file="/home/matt/projects/vue-custom-context-menu/src/components/Menu.vue",h.render||(h.render=a.render,h.staticRenderFns=a.staticRenderFns,h._compiled=!0,e&&(h.functional=!0)),h._scopeId=d;{let a;if(b&&(a=function(a){b.call(this,g(a))}),null!=a)if(h.functional){const b=h.render;h.render=function(c,d){return a.call(d),b(c,d)}}else{const b=h.beforeCreate;h.beforeCreate=b?[].concat(b,a):[a]}}return h}({render:k,staticRenderFns:[]},function(a){a&&a("data-v-b8503af6_0",{source:"\n.cm[data-v-b8503af6] {\n    box-sizing: border-box;\n    position: absolute;\n    display: block;\n    min-width: 200px;\n}\n.cm > div[data-v-b8503af6] {\n    height: 100%;\n    overflow: auto;\n}\n",map:{version:3,sources:["/home/matt/projects/vue-custom-context-menu/src/components/Menu.vue"],names:[],mappings:";AAwPA;IACA,uBAAA;IACA,mBAAA;IACA,eAAA;IACA,iBAAA;CACA;AAEA;IACA,aAAA;IACA,eAAA;CACA",file:"Menu.vue",sourcesContent:["<template>\n    <transition\n        :name=\"transition\"\n\n        ><div\n            class=\"cm\"\n            v-show=\"show\"\n            :style=\"style\"\n\n            @mouseenter=\"preventCollapsing\"\n            @mousedown.stop\n\n            ><div>\n                <ol>\n                    <slot></slot>\n                </ol>\n            </div>\n        </div>\n    </transition>\n</template>\n\n<script>\n    export default {\n        props: {\n            transition: String,\n            shift: {\n                type: String,\n                default: \"x\",\n                validator(value) {\n                    return [\"fit\", \"x\", \"y\", \"both\"].includes(value);\n                }\n            },\n            delay: {\n                type: Number,\n                default: 250,\n                validator(value) {\n                    return value > 0;\n                }\n            }\n        },\n\n        data() {return {\n            show: false,\n\n            style: {\n                left: 0,\n                top: 0,\n                height: \"auto\",\n                zIndex: 1\n            },\n\n            targetComp: null,\n\n            parent: null,\n            sub: null,\n\n            openTimer: null,\n            closeTimer: null\n        }},\n\n        computed: {\n            overlay() {\n                return this.$parent;\n            },\n\n            target() {\n                let parent = this;\n\n                while (parent.parent) {\n                    parent = parent.parent;\n                }\n\n                return parent.targetComp;\n            }\n        },\n\n        methods: {\n            open(event, caller) {\n                this.show = true;\n                this.style.zIndex = caller ? this.parent.style.zIndex + 1 : this.style.zIndex;\n\n                this.setPosition(event, caller);\n\n                this.$nextTick(() => {\n                    this.transpose(caller);\n                });\n            },\n\n            abstractOpen(event, caller, parent) {\n                if (!this.show) {\n                    if (parent) {\n                        this.parent = parent;\n                        this.parent.sub = this;\n                    }\n\n                    this.open(event, caller);\n                    this.openTimer = null;\n\n                    this.$emit(\"opened\", this.target, this);\n                }\n            },\n\n            immediateOpen(event, caller, parent) {\n                this.cancelDelayedOpen();\n                this.abstractOpen(event, caller, parent);\n            },\n\n            delayedOpen(event, caller, parent) {\n                this.cancelDelayedOpen();\n\n                this.openTimer = setTimeout(() => {\n                    this.abstractOpen(event, caller, parent);\n                }, parent.delay);\n            },\n\n            cancelDelayedOpen() {\n                if (this.openTimer) {\n                    clearTimeout(this.openTimer);\n                    this.openTimer = null;\n                }\n            },\n\n            close() {\n                this.show = false;\n                \n                this.targetComp = null;\n                this.style.height = \"auto\";\n                this.style.zIndex = 1;\n            },\n\n            abstractClose() {\n                if (this.show) {\n                    // this.target relies on this.parent that is gonna be deleted\n                    // before the @closed is emmited, so we need to save it beforehand\n                    var target = this.target;\n\n                    if (this.parent) {\n                        this.parent.sub = null;\n                        this.parent = null;\n                    }\n\n                    if (this.sub) {\n                        this.sub.immediateClose();\n                        this.sub = null;\n                    }\n\n                    this.close();\n                    this.closeTimer = null;\n\n                    this.$emit(\"closed\", target, this);\n                }\n            },\n\n            immediateClose() {\n                this.cancelDelayedClose();\n                this.abstractClose();\n            },\n\n            delayedClose() {\n                // in some rare cases this one is crucial\n                this.cancelDelayedClose();\n\n                this.closeTimer = setTimeout(() => {\n                    this.abstractClose();\n                }, this.parent.delay);\n            },\n\n            cancelDelayedClose() {\n                if (this.closeTimer) {\n                    clearTimeout(this.closeTimer);\n                    this.closeTimer = null;\n                }\n            },\n\n            preventCollapsing() {\n                let parent = this;\n\n                while (parent) {\n                    parent.cancelDelayedClose();\n                    parent = parent.parent;\n                }\n            },\n\n            setPosition(event, caller) {\n                if (caller) {\n                    this.style.left = caller.getBoundingClientRect().right;\n                    this.style.top = caller.getBoundingClientRect().top;\n                } else {\n                    this.style.left = event.clientX;\n                    this.style.top = event.clientY;\n                }\n\n                this.style.left += \"px\";\n                this.style.top += \"px\";\n            },\n\n            transpose(caller) {\n                let viewportWidth = this.overlay.$el.getBoundingClientRect().width;\n                let viewportHeight = this.overlay.$el.getBoundingClientRect().height;\n\n                let cmWidth = this.$el.getBoundingClientRect().width;\n                let cmHeight = this.$el.getBoundingClientRect().height;\n\n                let furthestX = this.$el.getBoundingClientRect().right;\n                let furthestY = this.$el.getBoundingClientRect().bottom;\n\n                if (furthestX >= viewportWidth) {\n                    if (this.shift === \"x\" || this.shift === \"both\") {\n                        if (caller) {\n                            this.style.left = caller.getBoundingClientRect().left - cmWidth;\n                        } else {\n                            this.style.left = parseFloat(this.style.left) - cmWidth;\n                        }\n                    } else {\n                        this.style.left = viewportWidth - cmWidth;\n                    }\n                }\n\n                if (furthestY >= viewportHeight) {\n                    if (this.shift === \"y\" || this.shift === \"both\") {\n                        if (caller) {\n                            this.style.top = caller.getBoundingClientRect().bottom - cmHeight;\n                        } else {\n                            this.style.top = parseFloat(this.style.top) - cmHeight;\n                        }\n                    } else {\n                        this.style.top = viewportHeight - cmHeight;\n                    }\n                }\n\n                this.style.left += \"px\";\n                this.style.top += \"px\";\n\n                this.$nextTick(() => {\n                    if (parseFloat(this.style.top) < 0) {\n                        this.style.top = \"0px\";\n\n                        if (cmHeight > viewportHeight) {\n                            this.style.height = viewportHeight + \"px\";\n                        }\n                    }\n                });\n            }\n        }\n    }\n</script>\n\n<style scoped>\n    .cm {\n        box-sizing: border-box;\n        position: absolute;\n        display: block;\n        min-width: 200px;\n    }\n\n    .cm > div {\n        height: 100%;\n        overflow: auto;\n    }\n</style>\n"]},media:void 0})},j,"data-v-b8503af6",!1,void 0,c,void 0),m={props:{action:Function,disabled:Boolean},data:function(){return{calls:null}},computed:{cm:function(){return this.$parent},isCaller:function(){return!!this.calls}},methods:{itemSelected:function(a){this.isCaller?this.cm.sub===this.calls?this.calls.cancelDelayedClose():(this.cm.sub&&this.cm.sub.delayedClose(),this.calls.delayedOpen(a,this.$el,this.cm)):this.cm.sub&&!this.cm.sub.closeTimer&&this.cm.sub.delayedClose()},selectionAborted:function(){this.isCaller&&this.calls.cancelDelayedOpen()},itemTriggered:function(a){this.isCaller?this.cm.sub!==this.calls&&(this.cm.sub&&this.cm.sub.immediateClose(),this.calls.immediateOpen(a,this.$el,this.cm)):(!this.disabled&&this.action&&this.action(this.cm.target,this.cm),this.cm.overlay.close())}}};var n=function(){var a=this,b=a.$createElement,c=a._self._c||b;return c("li",{staticClass:"cm-item",class:{caller:a.isCaller,disabled:a.disabled},on:{mouseenter:a.itemSelected,mouseleave:a.selectionAborted,mousedown:a.itemTriggered}},[a._t("default")],2)};n._withStripped=!0;var o,p=function(a,b,c,d,e){const f=("function"==typeof c?c.options:c)||{};return f.__file="/home/matt/projects/vue-custom-context-menu/src/components/Item.vue",f.render||(f.render=a.render,f.staticRenderFns=a.staticRenderFns,f._compiled=!0,e&&(f.functional=!0)),f._scopeId=d,f}({render:n,staticRenderFns:[]},void 0,m,void 0,!1,void 0,void 0,void 0),q={install:function(b,c){c=Object.assign({ref:"vccm-context-menus",directive:"context-menu",overlay:"vccm-overlay",menu:"context-menu",item:"cm-item"},c),b.directive(c.directive,a(c)),b.component(c.overlay,i),b.component(c.menu,l),b.component(c.item,p)}};return"undefined"==typeof window?"undefined"!=typeof global&&(o=global.Vue):o=window.Vue,o&&o.use(q),q});
